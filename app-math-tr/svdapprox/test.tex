\documentclass[12pt,fleqn]{article}\usepackage{../common}
\begin{document}

\begin{minted}[fontsize=\footnotesize]{python}
items_file = '%s/Downloads/ml-100k/u.item' % os.environ['HOME']
item_df = pd.read_csv(items_file, sep='|',header=None)
item_df['idx'] = item_df[0] - 1
item_df = item_df.set_index('idx')
\end{minted}


\begin{minted}[fontsize=\footnotesize]{python}
from scipy.io import mmread, mmwrite
import numpy as np, time, sys, os
import funk2, pandas as pd

user_feature_matrix = np.loadtxt("/tmp/user_feature_matrix2.dat")
movie_feature_matrix = np.loadtxt("/tmp/movie_feature_matrix2.dat")

preds = []
user_id = 90
for movie_id in range(1682):
    pred = funk2.predict_rating(user_id, movie_id, user_feature_matrix, movie_feature_matrix)
    preds.append([movie_id, pred])

preds_df = pd.DataFrame(preds,columns=['movie','score'])
preds_df.sort_index(by='score',ascending=False,inplace=True)
preds_df['movie_name'] = item_df[1]
print preds_df.head(10)
\end{minted}

\begin{verbatim}
      movie     score                        movie_name
1448   1448  4.759925            Pather Panchali (1955)
173     173  4.678653    Raiders of the Lost Ark (1981)
312     312  4.676880                    Titanic (1997)
21       21  4.640413                 Braveheart (1995)
168     168  4.601788        Wrong Trousers, The (1993)
11       11  4.583519        Usual Suspects, The (1995)
407     407  4.572863             Close Shave, A (1995)
49       49  4.565597                  Star Wars (1977)
63       63  4.565579  Shawshank Redemption, The (1994)
143     143  4.547612                   Die Hard (1988)
\end{verbatim}

\begin{minted}[fontsize=\footnotesize]{python}
A = mmread('%s/Downloads/A_m100k_train' % os.environ['HOME']).tocsc()
movies = A[user_id,:].nonzero()[1]
ratings = A[user_id,A[user_id,:].nonzero()[1]]
ratings = np.ravel(ratings.todense())
likes_df = pd.DataFrame()
likes_df['movie'] = movies; likes_df['rating'] = ratings
likes_df = likes_df.set_index('movie')
likes_df.sort_index(by='rating',ascending=False,inplace=True)
likes_df['movie_name'] = item_df[1]
print likes_df.head(10)
\end{minted}

\begin{verbatim}
       rating                                 movie_name
movie                                                   
21          5                          Braveheart (1995)
650         5                               Glory (1989)
30          5                        Crimson Tide (1995)
332         5                           Game, The (1997)
510         5                  Lawrence of Arabia (1962)
209         5  Indiana Jones and the Last Crusade (1989)
204         5                              Patton (1970)
602         5                         Rear Window (1954)
186         5             Godfather: Part II, The (1974)
175         5                              Aliens (1986)
\end{verbatim}






\end{document}
