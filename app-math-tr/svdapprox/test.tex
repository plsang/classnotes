\documentclass[12pt,fleqn]{article}\usepackage{../common}
\begin{document}

\begin{minted}[fontsize=\footnotesize]{python}
items_file = '%s/Downloads/ml-100k/u.item' % os.environ['HOME']
item_df = pd.read_csv(items_file, sep='|',header=None,index_col=0)
\end{minted}

\begin{minted}[fontsize=\footnotesize]{python}
from scipy.io import mmread, mmwrite
import numpy as np, time, sys, os
import funk2, pandas as pd

user_feature_matrix = np.loadtxt("/tmp/user_feature_matrix2.dat")
movie_feature_matrix = np.loadtxt("/tmp/movie_feature_matrix2.dat")

preds = []
user_id = 90
for movie_id in range(1682):
    pred = funk2.predict_rating(user_id, movie_id, user_feature_matrix, movie_feature_matrix)
    preds.append([movie_id, pred])

preds_df = pd.DataFrame(preds,columns=['movie','score'])
preds_df.sort_index(by='score',ascending=False,inplace=True)
preds_df['movie_name'] = item_df[1]
print preds_df.head(10)
\end{minted}

\begin{verbatim}
      movie     score                                      movie_name
1448   1448  4.759925                       My Favorite Season (1993)
173     173  4.678653                      Princess Bride, The (1987)
312     312  4.676880  Midnight in the Garden of Good and Evil (1997)
21       21  4.640413                   Muppet Treasure Island (1996)
168     168  4.601788          Monty Python and the Holy Grail (1974)
11       11  4.583519                            Seven (Se7en) (1995)
407     407  4.572863                                 Spy Hard (1996)
49       49  4.565597                                     I.Q. (1994)
63       63  4.565579                        Santa Clause, The (1994)
143     143  4.547612                      Sound of Music, The (1965)
\end{verbatim}

\begin{minted}[fontsize=\footnotesize]{python}
A = mmread('%s/Downloads/A_m100k_train' % os.environ['HOME']).tocsc()
movies = A[user_id,:].nonzero()[1]
ratings = A[user_id,A[user_id,:].nonzero()[1]]
ratings = np.ravel(ratings.todense())
likes_df = pd.DataFrame()
likes_df['movie'] = movies
likes_df['rating'] = ratings
likes_df.sort_index(by='rating',ascending=False,inplace=True)
likes_df['movie_name'] = item_df[1]
print likes_df.head(10)
\end{minted}

\begin{verbatim}
    movie  rating                   movie_name
0      21       5                          NaN
42    650       5                Clerks (1994)
1      30       5             Toy Story (1995)
24    332       5   Rumble in the Bronx (1995)
34    510       5  Doom Generation, The (1995)
19    209       5        Antonia's Line (1995)
18    204       5    White Balloon, The (1995)
39    602       5          Strange Days (1995)
15    186       5    Mr. Holland's Opus (1995)
12    175       5   Usual Suspects, The (1995)
\end{verbatim}






\end{document}
