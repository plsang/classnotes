\documentclass[12pt,fleqn]{article}\usepackage{../common}
\begin{document}
ID3

Zeki arama konusunda gördüðümüz gibi, arama algoritmasýna tahmin yeteneði
kazandýrdýðýmýzda problem sonucuna ulaþým hýzýmýzý arttýrmýþtýk. Tahmin
yeteneði, oyun tahtasýna deðer biçebilen iþlev sayesinde bilgisayara
kodlanmýþtý.

Bu noktada önemli bir soru þu olacaktýr; Ýnsan zekasýnda, tahmin neye
dayanýr? Üzerinde bilgimiz, tecrübemiz olmayan konu hakkýnda tahmin
yapabilirmiyiz? Hayýr. Öyle ise, bilgisayara tahmin özelliði
kazandýrdýðýmýz zaman, ayný zamanda makinaya "bilgi" verdiðimizi
söyleyebiliriz. Makinayý bilgilendirdik, ona tecrübe kazandýrdýk da
diyebiliriz çünkü tahmin, bir konu hakkýnda bilgimize, tecrübemize
dayandýðý ölçüde baþarýlý olabilir.

Bilgisayara bilgiyi iki þekilde verebiliriz: Yapýsal, ya da iþlevsel. Zeki
arama örneði iþlevsel bir örnek gösterdi. Bilgiyi, bilgisayara algoritma
halinde verdik. Tahta deðerlendiren iþlev, her taþa göre nasýl hesap
yapacaðýný biliyordu. Bu hesabý toplama ve çarpma iþlemlerini kullanarak ve
daha önceden "bildiði" aðýrlýklara göre birbirine ekleyerek tahta hakkýnda
ne düþündüðünü tek bir sayý halinde bildirdi, ve algoritmanýn geri kalaný,
bu deðerler ile doðru seçimi yaparak sonuca ulaþtý.

Bu yazýmýzda oyun oynama yerine, birçok seçeneðin arasýnda karar vermek
konusunu iþleyeceðiz. Zeki aramanýn aksine, bilgiyi bilgisayara iþlev
olarak deðil, bir karar aðaç yapýsý olarak vereceðiz, ve daha da iyisi
bilgisayarýn bu yapýyý "örnek veriden" kendi kendine öðrenmesini
saðlayacaðýz.

Karar Aðacý Nedir?

Video, televizyon gibi bir ev elektronik eþyasýnýn kýlavuzuna baktýðýnýzda,
"þu, þöyle olduysa þöyle yap" gibi tariflerin dolu olduðunu görürsünüz. Ýlk
önce kontrol edilmesi tavsiye edilen ayarlar vardýr, ve bu ayarlardan gelen
cevaba göre deðiþik ayarlara bakýlmasý tavsiye edilir ve en sonunda kýlavuz
ne hangi özel düðmeye basýlmasý gerektiðini söyler. Kullaným kýlavuzlarý
onlarca sayfalýk bir karar aðacýdýr denebilir. Ýnsanlara karar aðacýn
kavramý doðal geldiði için kýlavuzlar bu þekilde hazýrlanmýþtýr.

Diðer bir örnek, lokantalarda çok yemek yiyen birisinin kullandýðý karar
aðacý olabilir. Bu kimse her türlü deðiþik þart altýnda deðiþik lokantalara
gitmiþ, ve her seferindeki memnuniyet/piþmanlýk durumunu kayýt ederek bir
karar aðacý oluþturmuþ ise, artýk yeni bir lokantada karar kýlmasý için
kapýsýndan þöyle içeri bakýp menüye göz gezdirmesi yeterli olacaktýr.

Mesela bu zat'týn lokanta deneyimleri aþaðýdaki gibi kayýtlý olsun.

\includegraphics[height=3cm]{id3_veri.jpg}

Peki bu veriye bakarak karar aðacýný nasýl oluþturacaðýz?

Ýnsanýn aklýnda karar aðacýný oluþturmasý baþka bilim dallarý altýnda
araþtýrýlýyor. Bilgisayar için karar aðacýný "kendi kendine çýkartan" bir
yapay zeka algoritmasý (ID3), bu yazýmýzýn konusu olacak. ID3 ve genelde
öðrenen algoritmalar ve ileride mekanize-öðrenme konusuna giriþ açýsýndan
yararlý olabilir, ve bu konuda zaten en popüler yaklaþým olan ID3'ün geniþ
bir uygulama alaný vardýr.

Algoritma

Karar aðacýmýz öyle olsun ki, eðitim verisi ile eðitildikten sonra, yeni
bir soruya karþýlýlk, üstten baþlayarak yeni þartlar çerçevesinde (ama eski
veriye göre kurulmuþ) aðaçta bizi bir 'evet' ya da 'hayýr' cevabýna doðru
yönlendirsin. Ýyi kurulmuþ bir karar aðacý, "en az" soru ile "en çabuk"
cevaba eriþmemizi saðlayan aðaçtýr. Çünkü ileride de göreceðimiz gibi, ayný
veri için birden fazla deðiþik karar aðacý kurmak mümkündür.

Evet, algoritmamýza baþlayalým. Veriyi bölmek için, bir baþlýk seçmemiz
gerekiyor. Bu seçimi þimdilik rasgele yapalým, diyelim ki "Müþteri"
baþlýðýný seçtik. Veriye bakýnca, bu baþlýk altýnda "Hiç", "Biraz" ya da
"Dolu" deðerlerini görüyoruz. Bu baþlýðý en üst düðüm olarak aðaca
yerleþtirelim, ve veriyi, bu baþlýðýn altýnda tekrar eden deðerlere göre
guruplayýp, bölelim.

Alttaki aðaç, müþteri baþlýðý üzerinden oluþturulan aðacýmýzýn ilk
seviyesidir.

\includegraphics[height=5cm]{id3_hangi_baslik_1.jpg}

Yeþil ve kýrmýzý toplar evet=yeþil, hayýr=kýrmýzý cevaplarýný temsil
ediyorlar. Resimin anlatmak istediði, karar aðacý öðreniminin, eðitim
verisinin tamamýný böldüðü, ve seçenekler arasýnda taksim
ettiði. Elimizdeki verinin "hedef baþlýðý" "bekleyelim mi?" sorusudur, ve
cevabý sadece evet ya da hayýr olabilir. Yazýnýn geri kalan kýsmýnda
kýrmýzý ve yeþil toplarýn hepsini göstermeyeceðiz. Kolaylýk bakýmýndan
aðacýn en uç kýsmýnda tamamen yeþil ya da tamamen kýrmýzý var ise tek bir
renk göstermek yeterli olacak.

Aðacýn bu ilk seviyesine bakýnca, görüyoruz ki daha þimdiden elimizde
yararlý bir karar aðacý var. Çünkü eðer, 'müþteriler' sorusuna yeni sorunun
cevabý "hiç" olsaydý, direk olarak bir "Y" (Yanlýþ) cevabýna eriþmemiz
mümkün oluyordu. Bu noktada iþ bitiyor, karar verilmiþ olurdu. Tabii bu
cevap senaryosu çok iyimser bir senaryodur, çünkü eðer yeni sorunun cevabý
"Dolu" olsa idi, bu dalý izleyerek hala bölünmüþ olan bir dala geldiðimizi
görecektik. Demek ki aðaç oluþturan algoritmanýn iþi daha bitmedi. "Dolu"
dalýný takip ederek, oradaki verileri de bölmeye devam etmemiz gerekiyor.

Bu dalý bölmek için, 'müþteriler' baþlýðýndan sonra, gene rasgele olarak,
'bekleme süresi' baþlýðýný seçebiliriz. Eðer lokanta dolu ise, kapýda
beklememiz için eðitim verisinde elimizde olan bekleme süreleri bu baþlýk
altýnda toplanmýþ. Mümkün deðerler 60 dakika'dan fazla, 30-60 dakika arasý,
10-30 dakika arasý, ya da 10 dakika'dan daha az beklemek olarak
görülüyor. Bu bölünmeyi de yaptýktan sonra, sýrasý ile "müþteriler=dolu ve
bekleme süresi=60 dakidan fazla" sorusunun bizi kesin bir cevaba
eriþtirdiðini göreceðiz. Ayrýca, "müþteriler=dolu ve 10 dakikadan az
beklemek" sorusu bizi 'evet' cevabýna getirecektir. Bunlar da güzel. Fakat
iþimiz daha bitmedi, halâ bölünmemiþ dallar var, vs.

Herhalde algoritmanýn bölen ve aðaç oluþturan kýsmýnýn mantýðýný
anladýnýz. Tahmin edeceðiniz gibi, bu bölme ve dal oluþturma iþlemi tamamen
'evet' ve 'hayýr' sonuçlarýna eriþinceye kadar devam edecek. Sonuç karar
aðacýný aþaðýda görüyoruz.

\includegraphics[height=7cm]{id3_agac_ilk.jpg}

Optimizasyon

Yapay zeka dalýnda, algoritmalarýn doðruluðu kadar, bilgisayara getirdiði
yükün ne kadar önemli olduðunu görmüþtük. O kadar ki, eðer bu yük kontrol
edilir bir ölçüde deðil ise, algoritmanýn iþe yararlýlýðý sorgulanmaya
baþlanýr. Test olarak, bir algoritmanýn 12 veri satýrý (yukarýdaki örnek)
yerine , 500,000 satýrlýk veri ile ne yapacaðýný sormak yerinde olur. Çünkü
insan beyninin yaptýðý binbir türlü teknik kullanarak bu kadar veriyi
iþlemektir, aktif zekamýzda farkýnda olmasak bile, belli bir seviyede bu
iþlemler olmaktadýr. Basit bir iþ gibi görünen bir yerden bir yere kalkýp
yürümek için kullandýðýmýz algoritmalarýn neler çözmek zorunda olduðunu,
robot yazýlýmlar ile uðraþanlar bilir.

O yüzden, ID3 algoritmasýný 500,000 satýrlýk veriyi idare edebilecek
þekilde eniyileþtirmemiz gerekiyor.

Baþlýk Seçimi

Eniyileþtirme için uygun bir zaman herhalde baþlýk seçimi esnâsýnda
olacaktýr. Ýlk karar aðacýnda gördüðümüz gibi bazý sorulara olan cevaplar
daha ilk seviyede kesin cevaba eriþebiliyordu. Demek ki, sürekli olarak
"uygun baþlýðý uygun zamanda" seçersek, aðacýmýzý oldukça küçültmemiz
mümkün olur. Böylece kesin cevaba eriþmemiz kolaylaþýr. Tabii kolaylýk
derken, 500,000 satýrlýk veri için 100 derinliðindeki bir aðaç ile 10 birim
arasýndaki bir farktan bahsediyorum, ki bu fark hiç yabana atýlacak bir
fark deðildir.

Peki uygun baþlýk nedir? Mesela ilk seviye için, müþteri yerine, "yemek
türü" baþlýðýný seçseydik, daha mý iyi bir seçim yapmýþ olurduk? Bu farazi
bölünmeyi aþaðýdaki þekilde görelim.

\includegraphics[height=5cm]{id3_hangi_baslik_2.jpg}

Görüyoruz ki, bu yeni bölünme bizi hiç bir kesin cevaba götürmedi. Üstüne
üstlük, bütün bu dallarýn alt-dallarý, onlarýnda alt-dallarý derken
aðacýmýzýn arap saçýna dönmesi ihtimal dahilinde. Demek ki 'yemek türü'
bölünmesi bize yeni "bilgi" sâðlamadý. Halâ elimizde kesin cevaplar deðil,
seçenekler var.

Bize öyle bir iþlev lazým ki, her parçaya bakýp kazandýrdýðý bilgiyi
ölçsün, hala bölünmüþ kalan kýsýmlar içinde bile, onlardan en iyi olanýný
seçsin. Ýþte bu noktada bilgi kuramý yardýmýmýza yetiþiyor.

Bilgi Kuramý

Bilgi kuramý (information theory), bilgiyi nasýl kodlayacaðýmýzý ve sonuç
kodlamanýn ne kadar yer tutacaðý gibi sorunlar ile uðraþýr. Mesela,
elimizde 2 deðiþik deðer var ise ve bu deðerleri ikili düzende kodlamamýz
gerekse, bu iþ için kaç tane bit gerekir?

Cevap: Bir tane.

Peki, 4 tane deðer olduðunu düþünelim. Þimdi kaç tane? Cevap: Ýki. Tekrar
eden mantýðý belki de görmeye baþladýnýz. Eðer "kaç bit" sorusu ile "eldeki
bilgi" arasýnda matematiksel bir bâglantý kurmak gerekse (K ye B), þöyle
yazabiliriz. Parca Bilgi Degeri suna esit:

\[ -\frac{d}{d+y} log_2 \bigg( \frac{d}{d+y} \bigg) - 
\frac{y}{d+y} log_2 \bigg( \frac{y}{d+y} \bigg) 
\]

Adresleme, onluk düzen ve ikilik düzen arasýnda gidip gelme gibi
problemlerden hatýrlayabileceðimiz bir sonuç bu. Ya da, 'iki tane bit en
fazla kaç onluk sayýyý gösterir' sorusunun tersten sorulmuþ þeklidir
denebilir.

Þimdi, bu ters soruyu, karar aðacýnýn böldüðü her parçaya soralým. Tabii
birkaç deðiþiklik yapmamýz gerekecek. Mesela elimizde yemektürü=tayland
sonucunda tek bir parça üzerine 2 yanlýþ ve 2 doðru deðer var ise, bu
düðümün bilgi deðerini kesirler ile hesaplamamýz gerekecek. Kesirler ile
uðraþýrken, log iþlevi eksi deðerler getireceði için, cevabý önce kesirin
kendisi, sonra da eksi ile çarpmamýz lazým (log, 0 ve 1 arasý için eksi
deðer getirir). Yani, genel olarak iki cevaplý bir uzayda, tek parçanýn
bilgi deðeri þöyle gösterilebilir. Parca Bilgi Degeri suna esit:

\[ B(O(v_1),...,O(V_n)) = \sum_{i=1}^{n} -O(v_i)log_2O(v_i) \]

$O$, olasiligi temsil ediyor. 

Genel olarak göstermek gerekirse, n cevaplý bir uzayda parçanýn bilgi
deðeri þudur. 

\[ B \bigg(\frac{1}{2}, \frac{1}{2} \bigg) = 
\frac{1}{2}log_2 \bigg(\frac{1}{2} \bigg) 
- \frac{1}{2}log_2 \bigg(\frac{1}{2} \bigg) = \textrm { 1 bit }
 \]

Formülü kontrol etmek için, baþta verdiðimiz bit örneðini kullanalým: 2
deðiþik deðer için kaç bit gerekir?

\[ \sum_{i=1}^{parca} \frac{d_i + y_i}{d+y} 
\bigg( \frac{d_i}{d_i+y_i}, \frac{y_i}{d_i+y_i} \bigg)
\]

$d_i$: i'inci parca dogru sayisi
$y_i$: i'inci parca yanlis sayisi
$d$: tum dogrular
$y$: tum yanlislar

1 bit gerektiðini halâ bulabiliyoruz.

Parçalarýn Bilgi Deðer Toplamý

Bölündükten sonra elimize geçen parçalarýn bilgi deðer toplamý için 

Musteri Parcalari

\[  
\frac{2}{12}B(0,1) + \frac{4}{12}B(1,0) + \frac{6}{12} B(\frac{2}{6},
\frac{4}{6}) = 0.459
\]

Yemek Turu Parcalari

\[ 
\frac{2}{12}B(\frac{1}{2},\frac{1}{2}) + 
\frac{2}{12}B(\frac{1}{2},\frac{1}{2}) + 
\frac{4}{12}B(\frac{2}{4},\frac{2}{4}) + 
\frac{4}{12}B(\frac{2}{4},\frac{2}{4}) 
= 1
 \]

Problemi sözel olarak biraz daha berraklaþtýralým. Herhangi bir düðümde
iken, bu düðümün bilgi deðerini B() ile bulabiliriz. Lokanta örneðinin ilk
seviyesinde, en üst düðümün bilgi deðeri '1' olduðunu göreceksiniz, çünkü
elimizde tek düðüm, 6 yanlýþ, 6 doðru cevap var. Güzel.

Þimdi bir seviye aþaðý inelim. Her baþlýðý teker teker deneyip, ve veriyi
her baþlýk için geçici olarak parçalayýp, muhtemel her bölünme için bu
baþlýða tekâbül eden parçalarýn bilgi deðerini toplayalým (bir üstteki
formül).

Örnek veri üzerinde üstteki formülü deneyelim (1. seviye parçalanmasý için)

Musteri Parcalari

\[ 
\frac{2}{12}B(0,1) +
\frac{4}{12}B(1,0) +
\frac{6}{12}B(\frac{2}{6}, \frac{4}{6}) = 0.459
 \]

Yemek Turu Parcalari

\[ 
\frac{2}{12}B(\frac{1}{2}, \frac{1}{2}) + 
\frac{2}{12}B(\frac{1}{2}, \frac{1}{2}) + 
\frac{4}{12}B(\frac{2}{4}, \frac{2}{4}) + 
\frac{4}{12}B(\frac{2}{4}, \frac{2}{4})  = 1
 \]

Görüyoruz ki, aðacýn en üst seviyesini temsil etmek için 1 bit gerekiyor
iken, müþteri bölünmesinden sonra 0.459 bit yetiyor (daha az). Fakat yemek
türü bölünmesinden sonra halâ 1 bit lâzým! Yani, yemek türü bölünmesi bize
hiç bir þey kazandýrmadý.

Kazanç kelimesini aritmetik olarak þöyle târif edebiliriz: Bir düðümün
bilgi deðerinden, bu düðümün alt-parçalarýnýn bilgi deðer toplamýnýn
düþülmesi kazanç deðerini verir. ID3 algoritmasý, tabii ki daha az bit
gerektiren ya da, daha çok bilgi "kazandýran" seçeneði takip ederse daha
etkili olur. Böylece her seviyede gitgide daha berraklaþan karar aðacý, "en
az" seviyede, kesin kararlara "en çabuk" þekilde ulaþan karar aðacý
olacaktýr.

Eðer B() iþlevinin iç mekanizmalarý hala anlaþýlmadý ise, þunlarý bilmek
yardýmcý olabilir:

Parça tamamen yanlýþ deðerler içeriyor (kesin cevap) = B(0,1) = 0 bit

Parça tamamen doðru deðerler  içeriyor (kesin cevap) = B(1,0)  = 0 bit

...   3 doðru, 3 yanlýþ = B(3,3)  = 1 bit \\
...   2 doðru, 4 yanlýþ = B(2,4)  = 0.92 bit \\
...   1 doðru, 5 yanlýþ = B(1,5)  = 0.65 bit 

Eniyileþtirilmiþ algoritmanýn sonucu ortaya çýkacak karar aðacý þöyle
olacaktýr. Bu aðacýn ilk baþtaki aðaca kýyasla çok daha küçük olduðunu
görüyoruz.

\includegraphics[height=5cm]{id3_agac_eniyi.jpg}

\lstset{basicstyle=\scriptsize}

\lstinputlisting[language=Lisp,caption=id3.lisp,frame=lines]{id3.lisp}

\end{document}
